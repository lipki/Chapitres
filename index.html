<!doctype html>
<html>
  <head>
    <title>Chapitres - Home</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
  </head>
  <body class="parent">
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      socket.on('home', function (gameData) {

        const gameD = JSON.parse(gameData);

        console.log('A user is connected');
        console.log('├ random pseudo : ', gameD.playerPseudo);
        console.log('└ gameUUID : ' + gameD.gameUUID);

        document.getElementById('sendPseudo').value = gameD.playerPseudo;
        document.getElementById('sendGameUUID').value = gameD.gameUUID;
      });

      var newPlayer = function () {
        const playerPseudo = document.getElementById('sendPseudo').value;
        const gameUUID = document.getElementById('sendGameUUID').value;
        socket.emit('new player', JSON.stringify({'gameUUID':gameUUID, 'playerPseudo':playerPseudo}));
      }

      socket.on('switch to wait room', function (gameData) {

        const gameD = JSON.parse(gameData);

        console.log('switch to wait room');
        console.log('└ gameUUID : ' + gameD.gameUUID);

        console.log(document.getElementById('gameUUID'))
        document.getElementById('gameUUID').innerText = gameD.gameUUID;

        document.getElementById('home').style.display = 'none';
        document.getElementById('wait').style.display = 'block';
      });

      socket.on('update player list', function (gameData) {

        const gameD = JSON.parse(gameData);

        console.log('update player list');
        console.log('├ add player : ' + gameD.newplayer);
        console.log('├ remove player : ' + gameD.removeplayer);
        console.log('└ gameUUID : ' + gameD.gameUUID);

        document.getElementById('playerlist').replaceChildren();

        gameD.playerList.forEach(element => {
          console.log(' └ ' + element.pseudo);
          let li = document.createElement('li');
          li.innerText = element.pseudo;
          document.getElementById('playerlist').append(li);
        });
      });

    </script>
    <h1>Chapitres</h1>
    <section id="home">
      <div>
        <p>
          Text d'avertissement.
        </p>
      </div>
      <fieldset>
        <legend>Connectez-vous !</legend>
        <label for="sendPseudo">Choisisez un pseudo.</label>
        <input id="sendPseudo"><br/>
        <label for="sendGameUUID">Lancez cette partie, ou utilisez l'indentifiant d'une partie existante.</label>
        <input id="sendGameUUID"><br/>
        <button onclick="newPlayer()">Jouez !</button>
      </fieldset>
    </section>
    <section id="wait" class="display:none;">
      <h2 id="gameUUID"></h2>
      <ul id="playerlist"></ul>
      <button onclick="newPlayer()">Aller, on Joue, là !</button>
    </section>
  </body>
</html>
